/*
 *  jQuery selecTable Plugin - v0.0.1
 *  A simple jQuery plugin that makes table elements selectable with mouse or keyboard, just like tables of spreadsheet softwares.
 *  https://github.com/kyukyukyu/jquery-selectable
 *
 *  Made by Sanggyu Nam
 *  Under MIT License
 */
!function(a,b,c){function d(b,c){this.element=b,this.options=a.extend({},s,c),this._defaults=s,this._name=q,this.init()}var e="string",f=1,g=16,h=37,i=38,j=39,k=40,l=[g,h,i,j,k],m="cell",n="selecTable",o="selected",p="cursored",q="selecTable",r=b.document,s={};d.prototype.clearSelectedCells=function(){a(this.selectedCells).removeClass(o),this.selectedCells=[]},d.prototype.updateSelectedCells=function(b){this.clearSelectedCells();var c,d,e,f,g=this.$cellA,h=this.$cellB,i=g.data(m).split(","),j=h.data(m).split(","),k=Number(i[0]),l=Number(j[0]),n=Number(i[1]),p=Number(j[1]);k>l?(c=l,d=k):(c=k,d=l),n>p?(e=p,f=n):(e=n,f=p);for(var q=[],r=c;d>=r;++r)for(var s=a(this.$rows[r]),t=s.find("td"),u=e;f>=u;++u){var v=t[u];this.selectedCells.push(v),q.push({row:r,col:u}),a(v).addClass(o)}var w={selectedCells:a.extend([],this.selectedCells),selectedCellsNo:q,lastSelectedCell:h[0]};b&&b.pageX&&b.pageY&&(w.pageX=b.pageX,w.pageY=b.pageY),a(this.element).trigger("selectionupdate",w)};var t="plugin_"+q,u="table",v=function(b){return a(b).data(t)},w=function(b){var c;return a(b).parents(u).each(function(){var a=v(this);return a?(c=a,!1):void 0}),c},x=function(){return!1},y=function(b){a(b).attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).bind("selectstart",x)},z=function(b){a(b).attr("unselectable","").css({"-moz-user-select":"","-o-user-select":"","-khtml-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":""}).unbind("selectstart",x)};d.prototype.set$cellB=function(a){this.$cellB.removeClass(p),this.$cellB=a,this.$cellB.addClass(p)},d.prototype.mousedown=function(b){if(b.which!==f)return!0;var c=w(this);c.isShiftDown?c.selectedCells=[]:c.$cellA=a(b.target),c.isMouseDown=!0,y(r)},d.prototype.mouseenter=function(b){var c=this;setTimeout(function(){var d=w(c);return d.isMouseDown?(d.set$cellB(a(b.target)),void d.updateSelectedCells()):!0},0)},d.prototype.mouseup=function(b){if(b.which!==f)return!0;var c=w(this);c.isMouseDown=!1,c.set$cellB(a(b.target)),c.updateSelectedCells(b),z(r)},d.prototype.keydown=function(b){var c=v(this),d=b.which,e=!1;if(a.each(l,function(a,b){return d===b?(e=!0,!1):void 0}),!e)return!0;var f,n,o=c.$cellB,p=o.data(m).split(","),q=Number(p[0]),s=Number(p[1]);if(d===g)c.isShiftDown=!0;else{switch(d){case h:f=q,n=s-1,n=n>=0?n:0;break;case j:f=q,n=s+1,n=n<c.numOfCols?n:c.numOfCols-1;break;case i:f=q-1,f=f>=0?f:0,n=s;break;case k:f=q+1,f=f<c.numOfRows?f:c.numOfRows-1,n=s}var t=a(c.$rows[f]),u=a(t.find("td")[n]);c.isShiftDown||(c.$cellA=u),c.set$cellB(u),c.updateSelectedCells()}y(r)},d.prototype.keyup=function(a){var b=v(this);a.which===g&&(b.isShiftDown=!1),z(r)},d.prototype.blur=function(){var b=v(this);b.isMouseDown=!1,b.$cellA=a(),b.clearSelectedCells(),a(b.element).trigger("selectionupdate",{selectedCells:[],selectedCellsNo:[]})};var A=function(b){var c=a(b).find("tr");c.each(function(b){var c=a(this).find("td");c.each(function(c){a(this).data(m,b+","+c)})})};d.prototype.update=function(){var b=a(this.element),c=b.find("tr"),d=b.find("td");this.numOfRows=c.length,this.numOfCols=a(c[0]).find("td").length,this.$rows=c,A(this.element),this.$cellA=a(),this.$cellB=a(),this.isMouseDown=!1,this.isShiftDown=!1,this.selectedCells=[],d.off(".selecTable").on("mousedown.selecTable",this.mousedown).on("mouseenter.selecTable",this.mouseenter).on("mouseup.selecTable",this.mouseup)},d.prototype.init=function(){var b=a(this.element);b.on("keydown.selecTable",this.keydown).on("keyup.selecTable",this.keyup).on("blur.selecTable",this.blur),y(b),b.addClass(n),this.update()},a.fn[q]=function(b,f){return typeof b===e&&(f=b,b=c),this.each(function(){if(a.data(this,"plugin_"+q))switch(f){case"update":a.data(this,"plugin_"+q).update()}else a.data(this,"plugin_"+q,new d(this,b))})}}(jQuery,window);